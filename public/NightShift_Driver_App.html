<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NightShift Driver - Delivery Logger</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
        }
        #root {
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, useRef, createElement: h } = React;

        // Simple icon components (no external library needed)
        const Icon = ({ type, className = "w-5 h-5" }) => {
          const icons = {
            truck: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('rect', { x: 1, y: 3, width: 15, height: 13 }),
              h('polygon', { points: '16 8 20 8 23 11 23 16 16 16 16 8' }),
              h('circle', { cx: 5.5, cy: 18.5, r: 2.5 }),
              h('circle', { cx: 18.5, cy: 18.5, r: 2.5 })
            ),
            plus: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('line', { x1: 12, y1: 5, x2: 12, y2: 19 }),
              h('line', { x1: 5, y1: 12, x2: 19, y2: 12 })
            ),
            clock: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('circle', { cx: 12, cy: 12, r: 10 }),
              h('polyline', { points: '12 6 12 12 16 14' })
            ),
            check: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14' }),
              h('polyline', { points: '22 4 12 14.01 9 11.01' })
            ),
            alert: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('circle', { cx: 12, cy: 12, r: 10 }),
              h('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
              h('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
            ),
            camera: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z' }),
              h('circle', { cx: 12, cy: 13, r: 4 })
            ),
            edit: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7' }),
              h('path', { d: 'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z' })
            ),
            fuel: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M3 22v-14a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v14' }),
              h('line', { x1: 3, y1: 16.5, x2: 13, y2: 16.5 }),
              h('line', { x1: 13, y1: 13, x2: 17, y2: 13 }),
              h('line', { x1: 17, y1: 10, x2: 21, y2: 10 }),
              h('polyline', { points: '13 6 17 6 17 22' })
            ),
            wifi: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M5 12.55a11 11 0 0 1 14.08 0' }),
              h('path', { d: 'M1.42 9a16 16 0 0 1 21.16 0' }),
              h('path', { d: 'M8.53 16.11a6 6 0 0 1 6.95 0' }),
              h('line', { x1: 12, y1: 20, x2: 12.01, y2: 20 })
            ),
            wifiOff: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('line', { x1: 1, y1: 1, x2: 23, y2: 23 }),
              h('path', { d: 'M16.72 11.06A10.94 10.94 0 0 1 19 12.55' }),
              h('path', { d: 'M5 12.55a10.94 10.94 0 0 1 5.17-2.39' }),
              h('path', { d: 'M10.71 5.05A16 16 0 0 1 22.58 9' }),
              h('path', { d: 'M1.42 9a15.91 15.91 0 0 1 4.7-2.88' }),
              h('path', { d: 'M8.53 16.11a6 6 0 0 1 6.95 0' }),
              h('line', { x1: 12, y1: 20, x2: 12.01, y2: 20 })
            ),
            logout: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('path', { d: 'M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4' }),
              h('polyline', { points: '16 17 21 12 16 7' }),
              h('line', { x1: 21, y1: 12, x2: 9, y2: 12 })
            ),
            x: h('svg', { className, fill: 'none', stroke: 'currentColor', strokeWidth: 2, viewBox: '0 0 24 24' },
              h('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
              h('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
            )
          };
          return icons[type] || null;
        };

        function DriverApp() {
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [pin, setPin] = useState('');
          const [deliveries, setDeliveries] = useState([]);
          const [currentView, setCurrentView] = useState('list');
          const [selectedDelivery, setSelectedDelivery] = useState(null);
          const [isOnline, setIsOnline] = useState(navigator.onLine);
          const [pendingSync, setPendingSync] = useState([]);
          
          const [capturedPhoto, setCapturedPhoto] = useState(null);
          const [isSignaturePad, setIsSignaturePad] = useState(false);
          const canvasRef = useRef(null);
          const [isDrawing, setIsDrawing] = useState(false);

          const [showActionModal, setShowActionModal] = useState(false);
          const [actionType, setActionType] = useState('');
          const [actionData, setActionData] = useState({
            km: '',
            comments: ''
          });

          const STORAGE_KEY = 'nightshift_deliveries';
          const SYNC_KEY = 'nightshift_pending_sync';
          const CORRECT_PIN = '1234';

          useEffect(() => {
            const auth = localStorage.getItem('nightshift_auth');
            if (auth === 'true') {
              setIsAuthenticated(true);
            }

            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
              setDeliveries(JSON.parse(stored));
            }

            const pending = localStorage.getItem(SYNC_KEY);
            if (pending) {
              setPendingSync(JSON.parse(pending));
            }

            const handleOnline = () => {
              setIsOnline(true);
              syncPendingData();
            };
            const handleOffline = () => setIsOnline(false);

            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);

            return () => {
              window.removeEventListener('online', handleOnline);
              window.removeEventListener('offline', handleOffline);
            };
          }, []);

          const handleLogin = () => {
            if (pin === CORRECT_PIN) {
              setIsAuthenticated(true);
              localStorage.setItem('nightshift_auth', 'true');
              setPin('');
            } else {
              alert('Incorrect PIN');
              setPin('');
            }
          };

          const handleLogout = () => {
            setIsAuthenticated(false);
            localStorage.removeItem('nightshift_auth');
          };

          const syncPendingData = () => {
            console.log('Syncing pending data...', pendingSync);
            setPendingSync([]);
            localStorage.removeItem(SYNC_KEY);
          };

          const saveDeliveries = (newDeliveries) => {
            setDeliveries(newDeliveries);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(newDeliveries));
            
            if (!isOnline) {
              const newPending = [...pendingSync, { type: 'delivery_update', timestamp: Date.now(), data: newDeliveries }];
              setPendingSync(newPending);
              localStorage.setItem(SYNC_KEY, JSON.stringify(newPending));
            }
          };

          const generateDeliveryId = () => {
            const timestamp = Date.now();
            const random = Math.floor(Math.random() * 1000);
            return `NS${timestamp}${random}`;
          };

          const createNewDelivery = () => {
            const newDelivery = {
              id: generateDeliveryId(),
              status: 'created',
              createdAt: new Date().toISOString(),
              actions: [
                {
                  type: 'created',
                  timestamp: new Date().toISOString(),
                  note: 'Delivery created',
                  km: null,
                  comments: ''
                }
              ],
              kmPickup: null,
              kmDelivery: null,
              photos: [],
              signature: null
            };
            
            const updated = [...deliveries, newDelivery];
            saveDeliveries(updated);
            setSelectedDelivery(newDelivery);
            setCurrentView('detail');
          };

          const openActionModal = (type) => {
            setActionType(type);
            setActionData({ km: '', comments: '' });
            setShowActionModal(true);
          };

          const submitAction = () => {
            const kmValue = actionData.km ? parseFloat(actionData.km) : null;
            const comments = actionData.comments.trim();
            
            if (actionType === 'pickup_confirmed' || actionType === 'delivery_completed') {
              const actionName = actionType === 'pickup_confirmed' ? 'CONFIRM PICKUP' : 'COMPLETE DELIVERY';
              
              let confirmMessage = `Are you sure you want to ${actionName}?`;
              
              if (kmValue) {
                confirmMessage += `\n\nKM Reading: ${kmValue}`;
              }
              
              if (comments) {
                confirmMessage += `\n\nNotes: ${comments}`;
              }
              
              confirmMessage += `\n\nThis action cannot be undone.`;
              
              const userConfirmed = window.confirm(confirmMessage);
              
              if (!userConfirmed) {
                return;
              }
            }
            
            logAction(selectedDelivery.id, actionType, comments, kmValue);
            setShowActionModal(false);
            setActionData({ km: '', comments: '' });
          };

          const logAction = (deliveryId, actionType, comments = '', kmValue = null, photoData = null, signatureData = null) => {
            const updated = deliveries.map(d => {
              if (d.id === deliveryId) {
                const newAction = {
                  type: actionType,
                  timestamp: new Date().toISOString(),
                  note: comments || getDefaultNote(actionType),
                  km: kmValue,
                  comments: comments
                };
                
                const updatedDelivery = {
                  ...d,
                  actions: [...d.actions, newAction]
                };

                if (actionType === 'pickup_confirmed') {
                  updatedDelivery.status = 'picked_up';
                  if (kmValue !== null) updatedDelivery.kmPickup = kmValue;
                } else if (actionType === 'delivery_completed') {
                  updatedDelivery.status = 'completed';
                  if (kmValue !== null) updatedDelivery.kmDelivery = kmValue;
                } else if (actionType === 'waiting_start') {
                  updatedDelivery.status = 'waiting';
                } else if (actionType === 'waiting_end') {
                  updatedDelivery.status = d.status === 'waiting' ? 'picked_up' : d.status;
                }

                if (photoData) {
                  updatedDelivery.photos = [...(d.photos || []), { timestamp: new Date().toISOString(), data: photoData }];
                }

                if (signatureData) {
                  updatedDelivery.signature = signatureData;
                }

                return updatedDelivery;
              }
              return d;
            });
            
            saveDeliveries(updated);
            setSelectedDelivery(updated.find(d => d.id === deliveryId));
          };

          const getDefaultNote = (type) => {
            const notes = {
              pickup_confirmed: 'Pickup confirmed',
              delivery_completed: 'Delivery completed',
              waiting_start: 'Waiting period started',
              waiting_end: 'Waiting period ended',
              issue: 'Issue reported',
              fuel_stop: 'Fuel stop',
              photo_captured: 'Proof of delivery photo',
              signature_captured: 'Customer signature'
            };
            return notes[type] || type;
          };

          const getActionLabel = (type) => {
            const labels = {
              pickup_confirmed: 'Confirm Pickup',
              delivery_completed: 'Complete Delivery',
              waiting_start: 'Start Waiting',
              waiting_end: 'End Waiting',
              issue: 'Log Issue/Delay',
              fuel_stop: 'Fuel Stop'
            };
            return labels[type] || type;
          };

          const capturePhoto = (deliveryId) => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.capture = 'environment';
            
            input.onchange = (e) => {
              const file = e.target.files[0];
              if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                  logAction(deliveryId, 'photo_captured', 'Proof of delivery photo', null, event.target.result);
                };
                reader.readAsDataURL(file);
              }
            };
            
            input.click();
          };

          const startDrawing = (e) => {
            const canvas = canvasRef.current;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            ctx.moveTo(x, y);
            setIsDrawing(true);
          };

          const draw = (e) => {
            if (!isDrawing) return;
            
            e.preventDefault();
            const canvas = canvasRef.current;
            const rect = canvas.getBoundingClientRect();
            const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
            const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
            
            const ctx = canvas.getContext('2d');
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#0f172a';
            ctx.lineTo(x, y);
            ctx.stroke();
          };

          const stopDrawing = () => {
            setIsDrawing(false);
          };

          const clearSignature = () => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
          };

          const saveSignature = (deliveryId) => {
            const canvas = canvasRef.current;
            const signatureData = canvas.toDataURL();
            logAction(deliveryId, 'signature_captured', 'Customer signature', null, null, signatureData);
            setIsSignaturePad(false);
          };

          const getStatusColor = (status) => {
            const colors = {
              created: 'bg-gray-500',
              picked_up: 'bg-blue-500',
              waiting: 'bg-yellow-500',
              completed: 'bg-green-500'
            };
            return colors[status] || 'bg-gray-500';
          };

          const getStatusText = (status) => {
            const texts = {
              created: 'Created',
              picked_up: 'Picked Up',
              waiting: 'Waiting',
              completed: 'Completed'
            };
            return texts[status] || status;
          };

          if (!isAuthenticated) {
            return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center p-4' },
              h('div', { className: 'bg-slate-800 rounded-2xl p-8 max-w-md w-full border border-cyan-400/30 shadow-2xl' },
                h('div', { className: 'flex items-center justify-center mb-8' },
                  h('div', { className: 'bg-gradient-to-r from-cyan-400 to-blue-500 p-4 rounded-xl' },
                    h(Icon, { type: 'truck', className: 'w-12 h-12 text-white' })
                  )
                ),
                h('h1', { className: 'text-3xl font-bold text-white text-center mb-2' }, 'NightShift Driver'),
                h('p', { className: 'text-cyan-300 text-center mb-8' }, 'Delivery Logger'),
                h('div', { className: 'space-y-4' },
                  h('div', null,
                    h('label', { className: 'block text-cyan-300 font-semibold mb-2' }, 'Enter PIN'),
                    h('input', {
                      type: 'password',
                      inputMode: 'numeric',
                      value: pin,
                      onChange: (e) => setPin(e.target.value),
                      onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
                      className: 'w-full bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white text-center text-2xl tracking-widest focus:outline-none focus:ring-2 focus:ring-cyan-400',
                      placeholder: '••••',
                      maxLength: '4'
                    })
                  ),
                  h('button', {
                    onClick: handleLogin,
                    className: 'w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all'
                  }, 'Login')
                )
              )
            );
          }

          if (showActionModal && selectedDelivery) {
            return h('div', { className: 'fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4' },
              h('div', { className: 'bg-slate-800 rounded-2xl max-w-md w-full border border-cyan-400/30 shadow-2xl' },
                h('div', { className: 'p-4 border-b border-slate-700 flex justify-between items-center' },
                  h('h2', { className: 'text-xl font-bold text-white' }, getActionLabel(actionType)),
                  h('button', {
                    onClick: () => setShowActionModal(false),
                    className: 'text-slate-400 hover:text-white'
                  }, h(Icon, { type: 'x', className: 'w-6 h-6' }))
                ),
                h('div', { className: 'p-6 space-y-4' },
                  h('div', null,
                    h('label', { className: 'block text-cyan-300 font-semibold mb-2' },
                      'KM Reading ',
                      h('span', { className: 'text-slate-500 text-sm font-normal' }, '(optional)')
                    ),
                    h('input', {
                      type: 'number',
                      step: '0.1',
                      inputMode: 'decimal',
                      value: actionData.km,
                      onChange: (e) => setActionData({ ...actionData, km: e.target.value }),
                      className: 'w-full bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-400',
                      placeholder: 'Enter KM reading'
                    })
                  ),
                  h('div', null,
                    h('label', { className: 'block text-cyan-300 font-semibold mb-2' },
                      'Comments/Notes ',
                      h('span', { className: 'text-slate-500 text-sm font-normal' }, '(optional)')
                    ),
                    h('textarea', {
                      value: actionData.comments,
                      onChange: (e) => setActionData({ ...actionData, comments: e.target.value }),
                      className: 'w-full bg-slate-700/50 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-400 min-h-[100px]',
                      placeholder: 'Add any notes, location details, or observations...'
                    })
                  ),
                  h('div', { className: 'flex gap-3 pt-2' },
                    h('button', {
                      onClick: () => setShowActionModal(false),
                      className: 'flex-1 bg-slate-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-slate-600 transition-all'
                    }, 'Cancel'),
                    h('button', {
                      onClick: submitAction,
                      className: 'flex-1 bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all'
                    }, 'Log Action')
                  )
                )
              )
            );
          }

          if (isSignaturePad && selectedDelivery) {
            return h('div', { className: 'fixed inset-0 bg-slate-900 z-50 flex flex-col' },
              h('div', { className: 'bg-slate-800 p-4 flex justify-between items-center' },
                h('h2', { className: 'text-white font-bold' }, 'Customer Signature'),
                h('button', {
                  onClick: () => setIsSignaturePad(false),
                  className: 'text-white'
                }, 'Cancel')
              ),
              h('div', { className: 'flex-1 flex flex-col items-center justify-center p-4' },
                h('div', { className: 'bg-white rounded-lg p-4 w-full max-w-lg' },
                  h('canvas', {
                    ref: canvasRef,
                    width: 400,
                    height: 200,
                    onMouseDown: startDrawing,
                    onMouseMove: draw,
                    onMouseUp: stopDrawing,
                    onMouseLeave: stopDrawing,
                    onTouchStart: startDrawing,
                    onTouchMove: draw,
                    onTouchEnd: stopDrawing,
                    className: 'border-2 border-slate-300 rounded touch-none w-full',
                    style: { touchAction: 'none' }
                  })
                ),
                h('div', { className: 'flex gap-3 mt-6' },
                  h('button', {
                    onClick: clearSignature,
                    className: 'bg-slate-700 text-white px-6 py-3 rounded-lg font-semibold'
                  }, 'Clear'),
                  h('button', {
                    onClick: () => saveSignature(selectedDelivery.id),
                    className: 'bg-gradient-to-r from-cyan-500 to-blue-500 text-white px-6 py-3 rounded-lg font-semibold'
                  }, 'Save Signature')
                )
              )
            );
          }

          if (currentView === 'detail' && selectedDelivery) {
            return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900' },
              h('div', { className: 'bg-slate-800 border-b border-cyan-400/30 p-4 sticky top-0 z-10' },
                h('div', { className: 'flex items-center justify-between' },
                  h('button', {
                    onClick: () => setCurrentView('list'),
                    className: 'text-cyan-300 font-semibold'
                  }, '← Back'),
                  h('div', { className: 'flex items-center gap-2' },
                    isOnline
                      ? h(Icon, { type: 'wifi', className: 'w-5 h-5 text-green-400' })
                      : h(Icon, { type: 'wifiOff', className: 'w-5 h-5 text-yellow-400' })
                  )
                ),
                h('div', { className: 'mt-3' },
                  h('h1', { className: 'text-xl font-bold text-white' }, selectedDelivery.id),
                  h('div', { className: `inline-block px-3 py-1 rounded-full text-xs font-semibold text-white mt-2 ${getStatusColor(selectedDelivery.status)}` },
                    getStatusText(selectedDelivery.status)
                  )
                )
              ),
              h('div', { className: 'p-4 space-y-4 pb-24' },
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20' },
                  h('h3', { className: 'text-cyan-300 font-semibold mb-3' }, 'Quick Actions'),
                  h('div', { className: 'grid grid-cols-2 gap-3' },
                    selectedDelivery.status !== 'completed' && [
                      selectedDelivery.status === 'created' && h('button', {
                        key: 'pickup',
                        onClick: () => openActionModal('pickup_confirmed'),
                        className: 'bg-blue-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'check' }), 'Confirm Pickup'),
                      (selectedDelivery.status === 'picked_up' || selectedDelivery.status === 'waiting') && h('button', {
                        key: 'complete',
                        onClick: () => openActionModal('delivery_completed'),
                        className: 'bg-green-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'check' }), 'Complete'),
                      selectedDelivery.status !== 'waiting' && selectedDelivery.status === 'picked_up' && h('button', {
                        key: 'wait-start',
                        onClick: () => openActionModal('waiting_start'),
                        className: 'bg-yellow-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'clock' }), 'Start Wait'),
                      selectedDelivery.status === 'waiting' && h('button', {
                        key: 'wait-end',
                        onClick: () => openActionModal('waiting_end'),
                        className: 'bg-blue-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'clock' }), 'End Wait'),
                      h('button', {
                        key: 'issue',
                        onClick: () => openActionModal('issue'),
                        className: 'bg-red-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'alert' }), 'Log Issue'),
                      h('button', {
                        key: 'fuel',
                        onClick: () => openActionModal('fuel_stop'),
                        className: 'bg-orange-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'fuel' }), 'Fuel Stop'),
                      h('button', {
                        key: 'photo',
                        onClick: () => capturePhoto(selectedDelivery.id),
                        className: 'bg-purple-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'camera' }), 'Take Photo'),
                      h('button', {
                        key: 'signature',
                        onClick: () => setIsSignaturePad(true),
                        className: 'bg-indigo-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center gap-2'
                      }, h(Icon, { type: 'edit' }), 'Signature')
                    ]
                  )
                ),
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20' },
                  h('h3', { className: 'text-cyan-300 font-semibold mb-3' }, 'Distance Tracking'),
                  h('div', { className: 'grid grid-cols-2 gap-4' },
                    h('div', null,
                      h('p', { className: 'text-slate-400 text-sm' }, 'Pickup KM'),
                      h('p', { className: 'text-white text-xl font-bold' }, selectedDelivery.kmPickup || '-')
                    ),
                    h('div', null,
                      h('p', { className: 'text-slate-400 text-sm' }, 'Delivery KM'),
                      h('p', { className: 'text-white text-xl font-bold' }, selectedDelivery.kmDelivery || '-')
                    ),
                    selectedDelivery.kmPickup && selectedDelivery.kmDelivery && h('div', { className: 'col-span-2' },
                      h('p', { className: 'text-slate-400 text-sm' }, 'Total Distance'),
                      h('p', { className: 'text-cyan-400 text-2xl font-bold' },
                        `${(selectedDelivery.kmDelivery - selectedDelivery.kmPickup).toFixed(1)} km`
                      )
                    )
                  )
                ),
                selectedDelivery.photos && selectedDelivery.photos.length > 0 && h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20' },
                  h('h3', { className: 'text-cyan-300 font-semibold mb-3' }, `Photos (${selectedDelivery.photos.length})`),
                  h('div', { className: 'grid grid-cols-2 gap-2' },
                    selectedDelivery.photos.map((photo, idx) =>
                      h('img', {
                        key: idx,
                        src: photo.data,
                        alt: `Proof ${idx + 1}`,
                        className: 'rounded-lg w-full h-32 object-cover border border-slate-600'
                      })
                    )
                  )
                ),
                selectedDelivery.signature && h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20' },
                  h('h3', { className: 'text-cyan-300 font-semibold mb-3' }, 'Customer Signature'),
                  h('img', {
                    src: selectedDelivery.signature,
                    alt: 'Signature',
                    className: 'rounded-lg w-full border border-slate-600 bg-white'
                  })
                ),
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20' },
                  h('h3', { className: 'text-cyan-300 font-semibold mb-3' }, 'Action Log'),
                  h('div', { className: 'space-y-3' },
                    selectedDelivery.actions.slice().reverse().map((action, idx) =>
                      h('div', { key: idx, className: 'flex items-start gap-3 pb-3 border-b border-slate-700 last:border-0' },
                        h('div', { className: 'bg-cyan-500/20 p-2 rounded-lg' },
                          h(Icon, { type: 'clock', className: 'w-4 h-4 text-cyan-400' })
                        ),
                        h('div', { className: 'flex-1' },
                          h('p', { className: 'text-white font-semibold capitalize' }, action.type.replace(/_/g, ' ')),
                          action.km && h('p', { className: 'text-cyan-400 text-sm font-bold' }, `📍 ${action.km} km`),
                          action.comments && h('p', { className: 'text-slate-300 text-sm mt-1' }, action.comments),
                          h('p', { className: 'text-slate-500 text-xs mt-1' }, new Date(action.timestamp).toLocaleString())
                        )
                      )
                    )
                  )
                )
              )
            );
          }

          return h('div', { className: 'min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900' },
            h('div', { className: 'bg-slate-800 border-b border-cyan-400/30 p-4 sticky top-0 z-10' },
              h('div', { className: 'flex items-center justify-between' },
                h('div', { className: 'flex items-center gap-3' },
                  h('div', { className: 'bg-gradient-to-r from-cyan-400 to-blue-500 p-2 rounded-lg' },
                    h(Icon, { type: 'truck', className: 'w-6 h-6 text-white' })
                  ),
                  h('div', null,
                    h('h1', { className: 'text-xl font-bold text-white' }, 'NightShift Driver'),
                    h('p', { className: 'text-cyan-300 text-sm' }, 'Delivery Logger')
                  )
                ),
                h('div', { className: 'flex items-center gap-3' },
                  isOnline
                    ? h(Icon, { type: 'wifi', className: 'w-5 h-5 text-green-400' })
                    : h('div', { className: 'flex items-center gap-2' },
                        h(Icon, { type: 'wifiOff', className: 'w-5 h-5 text-yellow-400' }),
                        pendingSync.length > 0 && h('span', { className: 'bg-yellow-500 text-white text-xs px-2 py-1 rounded-full' }, pendingSync.length)
                      ),
                  h('button', {
                    onClick: handleLogout,
                    className: 'text-cyan-300'
                  }, h(Icon, { type: 'logout' }))
                )
              )
            ),
            h('div', { className: 'p-4' },
              h('div', { className: 'grid grid-cols-3 gap-3 mb-4' },
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20 text-center' },
                  h('p', { className: 'text-slate-400 text-xs mb-1' }, 'Active'),
                  h('p', { className: 'text-white text-2xl font-bold' }, deliveries.filter(d => d.status !== 'completed').length)
                ),
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-green-400/20 text-center' },
                  h('p', { className: 'text-slate-400 text-xs mb-1' }, 'Completed'),
                  h('p', { className: 'text-green-400 text-2xl font-bold' }, deliveries.filter(d => d.status === 'completed').length)
                ),
                h('div', { className: 'bg-slate-800 rounded-xl p-4 border border-blue-400/20 text-center' },
                  h('p', { className: 'text-slate-400 text-xs mb-1' }, 'Total'),
                  h('p', { className: 'text-blue-400 text-2xl font-bold' }, deliveries.length)
                )
              ),
              h('div', { className: 'space-y-3' },
                deliveries.length === 0
                  ? h('div', { className: 'bg-slate-800 rounded-xl p-8 text-center border border-cyan-400/20' },
                      h(Icon, { type: 'truck', className: 'w-12 h-12 text-slate-600 mx-auto mb-3' }),
                      h('p', { className: 'text-slate-400' }, 'No deliveries yet'),
                      h('p', { className: 'text-slate-500 text-sm' }, 'Create your first delivery to start logging')
                    )
                  : deliveries.slice().reverse().map(delivery =>
                      h('div', {
                        key: delivery.id,
                        onClick: () => {
                          setSelectedDelivery(delivery);
                          setCurrentView('detail');
                        },
                        className: 'bg-slate-800 rounded-xl p-4 border border-cyan-400/20 cursor-pointer hover:border-cyan-400 transition-all'
                      },
                        h('div', { className: 'flex items-center justify-between mb-2' },
                          h('h3', { className: 'text-white font-semibold' }, delivery.id),
                          h('div', { className: `px-3 py-1 rounded-full text-xs font-semibold text-white ${getStatusColor(delivery.status)}` },
                            getStatusText(delivery.status)
                          )
                        ),
                        h('div', { className: 'flex items-center justify-between text-sm' },
                          h('span', { className: 'text-slate-400' }, new Date(delivery.createdAt).toLocaleString()),
                          h('span', { className: 'text-cyan-400' }, `${delivery.actions.length} actions`)
                        )
                      )
                    )
              )
            ),
            h('button', {
              onClick: createNewDelivery,
              className: 'fixed bottom-6 right-6 bg-gradient-to-r from-cyan-500 to-blue-500 text-white p-4 rounded-full shadow-2xl hover:shadow-cyan-500/50 transition-all z-20'
            }, h(Icon, { type: 'plus', className: 'w-8 h-8' }))
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(DriverApp));
    </script>
</body>
</html>